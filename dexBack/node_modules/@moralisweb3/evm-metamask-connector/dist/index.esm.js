import{EvmAbstractConnector}from"@moralisweb3/evm-connector-utils";import{MoralisCoreProvider,MoralisNetworkConnectorError,NetworkConnectorErrorCode,EvmChain,EvmAddress}from"@moralisweb3/core";var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function __awaiter(e,i,c,s){return new(c=c||Promise)(function(r,t){function n(e){try{a(s.next(e))}catch(e){t(e)}}function o(e){try{a(s.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?r(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,o)}a((s=s.apply(e,i||[])).next())})}function __generator(n,o){var a,i,c,s={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(r){return function(e){var t=[r,e];if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,i&&(c=2&t[0]?i.return:t[0]?i.throw||((c=i.return)&&c.call(i),0):i.next)&&!(c=c.call(i,t[1])).done)return c;switch(i=0,(t=c?[2&t[0],c.value]:t)[0]){case 0:case 1:c=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(c=0<(c=s.trys).length&&c[c.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!c||t[1]>c[0]&&t[1]<c[3])){s.label=t[1];break}if(6===t[0]&&s.label<c[1]){s.label=c[1],c=t;break}if(c&&s.label<c[2]){s.label=c[2],s.ops.push(t);break}c[2]&&s.ops.pop(),s.trys.pop();continue}t=o.call(n,s)}catch(e){t=[6,e],i=0}finally{a=c=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function detectEthereumProvider({mustBeMetaMask:n=!1,silent:o=!1,timeout:e=3e3}){if("boolean"!=typeof n)throw new Error("@metamask/detect-provider: Expected option 'mustBeMetaMask' to be a boolean.");if("boolean"!=typeof o)throw new Error("@metamask/detect-provider: Expected option 'silent' to be a boolean.");if("number"!=typeof e)throw new Error("@metamask/detect-provider: Expected option 'timeout' to be a number.");let a=!1;return new Promise(t=>{function r(){var e;a||(a=!0,window.removeEventListener("ethereum#initialized",r),e=window["ethereum"],!e||n&&!e.isMetaMask?(o||console.error("@metamask/detect-provider:",n&&e?"Non-MetaMask window.ethereum detected.":"Unable to detect window.ethereum."),t(null)):t(e))}window.ethereum?r():(window.addEventListener("ethereum#initialized",r,{once:!0}),setTimeout(()=>{r()},e))})}var dist=detectEthereumProvider,DEFAULT_OPTIONS={silent:!1,timeout:3e4},EvmMetamaskConnector=function(t){function r(e){return t.call(this,r.connectorName,e)||this}return __extends(r,t),r.create=function(e){return new r(e||MoralisCoreProvider.getDefault())},r.prototype.createProvider=function(r){var n;return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,dist({silent:null==r?void 0:r.silent,timeout:null==r?void 0:r.timeout,mustBeMetaMask:!0})];case 1:if(t=(t=e.sent())&&null!=(n=t.providers)&&n.length?null!=(n=t.providers.find(function(e){return e.isMetaMask}))?n:null:t)return[2,t];throw new MoralisNetworkConnectorError({code:NetworkConnectorErrorCode.NO_PROVIDER,message:"No injected provider found at 'window.ethereum', make sure to have Metamask or any other injected wallet installed."})}})})},r.prototype.createConnection=function(a){return __awaiter(this,void 0,void 0,function(){var t,r,n,o;return __generator(this,function(e){switch(e.label){case 0:return r=__assign(__assign({},DEFAULT_OPTIONS),{options:a}),this.logger.verbose("Connecting",{providedOptions:a,options:r}),[4,this.getProvider(r)];case 1:return t=e.sent(),[4,Promise.all([t.request({method:"eth_requestAccounts"}),t.request({method:"eth_chainId"})])];case 2:return r=e.sent(),n=r[0],o=r[1],[2,{provider:t,chain:EvmChain.create(o),account:n[0]?EvmAddress.create(n[0]):null}]}})})},r.prototype.switchNetwork=function(o){return __awaiter(this,void 0,void 0,function(){var t,r,n;return __generator(this,function(e){switch(e.label){case 0:return t=EvmChain.create(o),[4,this.getProvider()];case 1:return r=e.sent(),(n=this.chain)&&n.equals(t)?[2]:[4,r.request({method:"wallet_switchEthereumChain",params:[{chainId:t.hex}]})];case 2:return e.sent(),[2]}})})},r.prototype.addNetwork=function(r){var n;return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=EvmChain.create(r),[4,this.getProvider()];case 1:return[4,e.sent().request({method:"wallet_addEthereumChain",params:[{chainId:t.hex,chainName:t.name,nativeCurrency:t.currency?{name:t.currency.name,symbol:t.currency.symbol,decimals:t.currency.decimals}:void 0,rpcUrls:t.rpcUrls,blockExplorerUrls:null!=(n=t.explorer)&&n.url?[t.explorer.url]:null}]})];case 2:return e.sent(),[2]}})})},r.connectorName="metamask",r}(EvmAbstractConnector),create=EvmMetamaskConnector.create;export{EvmMetamaskConnector,create,EvmMetamaskConnector as default};
//# sourceMappingURL=index.esm.js.map
